
# 更新日志 (CHANGELOG)

---

## v2.0.0 (2025/12/10) - All-in-One 重大更新

### 🎉 新增功能

- **APatch 框架支持**
  - 新增 APatch 环境变量检测 (`$APATCH`, `$APATCH_VER`)
  - 通过路径 `/data/adb/ap` 自动推断框架类型
  - BusyBox 路径新增 `/data/adb/ap/bin/busybox`
  - 所有脚本统一支持三框架：Magisk / KernelSU / APatch

- **数据目录自动迁移**
  - 升级安装时自动检测旧数据目录
  - 交互式选择是否迁移数据
  - 自动迁移内容：数据库、配置文件、下载文件、会话文件
  - 自动更新配置文件中的路径引用
  - 迁移后可选删除旧目录节省空间

- **多服务集成**
  - **Aria2**：高速下载器，支持 HTTP/FTP/BT/磁力链接
  - **Qbittorrent**：专业 BT/PT 下载客户端
  - **Frpc**：内网穿透客户端，支持远程访问
  - **Rclone**：云存储同步工具（按需调用）
  
- **现代化 WebUI**
  - 集成 **AriaNg** 作为 Aria2 管理界面
  - 集成 **VueTorrent** 作为 Qbittorrent 界面
  
- **服务配置文件** `services.conf`
  - 灵活控制各服务启用/禁用
  - 修改后重启即可生效
  
- **自动生成默认配置**
  - 首次启动自动创建所有配置文件
  - `aria2.conf` 已预置优化参数
  - `frpc.toml` 提供配置模板

- **多服务状态显示**
  - 模块描述显示所有运行中服务及 PID
  - 格式：`OpenList:IP:5244(PID) | Aria2:IP:6800(PID) | QB:IP:8080(PID)`

### 🔧 优化改进

- **统一下载目录**：所有下载器共享 `<数据目录>/downloads/`
- **统一配置目录**：所有配置文件集中在 `<数据目录>/config/`
- **Action 按钮升级**：一键启停所有已启用服务
- **卸载脚本增强**：
  - 自动停止所有服务（OpenList/Aria2/Qbittorrent/Frpc）
  - 交互式数据清理选项（全保留/仅删配置/全删）
  - 显示数据目录大小信息

- **框架检测优化**
  - 优先使用环境变量检测
  - 备用路径推断机制
  - 日志记录当前框架类型

### 📋 默认配置

| 服务 | 端口 | 默认状态 | 备注 |
|------|------|---------|------|
| OpenList | 5244 | ✅ 启用 | 核心服务 |
| Aria2 | 6800 | ❌ 禁用 | RPC密钥: `openlist` |
| Qbittorrent | 8080 | ❌ 禁用 | 默认账号: admin/adminadmin |
| Frpc | - | ❌ 禁用 | 需手动配置服务器 |
| Rclone | - | - | 仅提供二进制，按需调用 |

### ⚠️ 注意事项

- **架构要求**：Aria2/Qbittorrent/Frpc 仅支持 ARM64 设备
- **存储空间**：完整安装约需 150MB
- **首次启动**：会自动生成配置文件，可能需要 5-10 秒
- **APatch 用户**：建议将二进制安装到 `/data/adb/openlist/bin`

---

## v1.x.x 历史更新记录

### 2025/11/22 00:12
- 优化安装脚本，在安装时根据用户选择把所选路径统一赋值到 service 和 action
- 简化了在安装后脚本在每次启动时会同时遍寻 3 个路径寻找二进制和数据目录的问题
- Magisk/KSU 管理器新增 PID 进程显示
- **特别感谢 @lidawei97688 付出，本次代码优化由 @lidawei97688 提交的 PR 贡献！！**

### 2025/11/12 00:37
- 新增逻辑：手机未处于 WiFi 模式时，显示 `localhost:端口`，而不是转圈圈显示获取 IP 失败
  > 说明：localhost = 127.0.0.1 属于本地回环 IP，只能用于本机访问，不能用于局域网访问。移动网络的大内网 IP（10.x.x.x 或 172.x.x.x）公网无法访问，局域网也无法访问，因此不予显示。
- 统一使用 Magisk 或 KSU 提供的 BusyBox 指令集，解决不同安卓版本、不同手机厂商因自身 Android 自带的 Toybox（阉割版指令集）导致的兼容性问题
- 使用 BusyBox 指令集更新了 action 脚本

### 2025/11/6 22:44
- 修复 action.sh 细节问题
- 优化 service.sh 获取 IP 地址代码
- 确认无需对 SuKiSU 做专门适配（与 KSU 路径一致）

### 2025/10/12 17:00
- 优化 action.sh 开关判定逻辑（修复部分机型只能关不能启动的问题）
- 测试确认 SuKiSU 框架可用（安装时选择 `/data/adb/openlist` 路径）

### 2025/10/9 02:07
- 测试第三方 OpenList 魔改二进制（123盘解除限制版），确认无效
- 继续使用 OpenList 官方二进制

### 2025/10/2 23:45
- 添加 KernelSU 支持检测和路径处理逻辑
- 使用占位符替换方式更新 service.sh 配置
- 实现通用的 BusyBox 查找函数提高兼容性
- 删除不再使用的 KSU.yml 工作流文件

---

## 📅 开发计划

- [x] APatch 框架支持
- [x] 二次升级安装时数据目录自动迁移
- [ ] 无按键设备支持（倒计时自动确认）
- [ ] 实时 IP 刷新（可选的循环检测脚本）

---

> 💡 **提示**：平常默认无人工干预，工作流自动跟踪 OpenList 最新二进制打包。没有更新日志说明模块逻辑无变化，仅更新了 OpenList 版本。
